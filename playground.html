<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Sass.js playground - emscripted libsass in the browser</title>
  <link rel="stylesheet" href="assets/libs/normalize.css/normalize.css">
  <link rel="stylesheet" href="assets/css/style.css">
<body>

  <header>
    <h1 id="title">Sass.js Playground</h1>
    <p id="subtitle">
      For more information on how to convert SCSS and SASS in the browser using emscripted &amp; libsass
      see the <a href="https://github.com/medialize/sass.js/">Sass.js repository</a>.
    </p>
    <nav>
      <button class="options-btn">Options</button>
      <button class="input-output-btn">Compile</button>
      <button class="filesystem-btn">Filesystem</button>
    </nav>
  </header>

  <div id="playground">
    <h2>Sass.options()</h2>
    <article id="options">

      <section class="option">
        <span class="comment">See <a href="http://sass-lang.com/documentation/file.SASS_REFERENCE.html#output_style">documentation</a></span>
        <label for="options-style">style</label>
        <select id="option-style">
          <option value="0">nested</option>
          <option value="1">expanded</option>
          <option value="2">compact</option>
          <option value="3">compressed</option>
        </select>
      </section>

      <section class="option">
        <span class="comment">Emit comments in the generated CSS indicating the corresponding source line.</span>
        <label for="option-comments">comments</label>
        <select id="option-comments">
          <option value="">none</option>
          <option value="1">default</option>
        </select>
      </section>

      <section class="option">
        <span class="comment">Precision for fractional numbers (<code>0</code>: libsass default)</span>
        <label for="option-precision">precision</label>
        <input id="option-precision" type="number" min="0" step="1" value="0">
      </section>

      <section class="option">
        <span class="comment">Treat source_string as SASS (as opposed to SCSS)</span>
        <label for="option-indentedSyntax">indentedSyntax</label>
        <select id="option-indentedSyntax">
          <option value="" selected>false (SCSS)</option>
          <option value="1">true (SASS)</option>
        </select>
      </section>

      <section class="option">
        <span class="comment">String to be used for indentation</span>
        <label for="option-indent">indent</label>
        <select id="option-indent">
          <option value="  " selected>2 Spaces</option>
          <option value="    ">4 Spaces</option>
          <option value="	">Tab</option>
        </select>
      </section>

      <section class="option">
        <span class="comment">String to be used to for line feeds</span>
        <label for="option-linefeed">linefeed</label>
        <select id="option-linefeed">
          <option value="\n" selected>\n</option>
          <option value="\r\n">\r\n</option>
        </select>
      </section>

      <section class="option">
        <span class="comment">Path to source map file. Enables source map generation. Used to create sourceMappingUrl</span>
        <label for="option-sourceMapFile">sourceMapFile</label>
        <input id="option-sourceMapFile" type="text" value="file">
      </section>

      <section class="option">
        <span class="comment">Directly inserted in source maps</span>
        <label for="option-sourceMapRoot">sourceMapRoot</label>
        <input id="option-sourceMapRoot" type="text" value="root">
      </section>

      <section class="option">
        <span class="comment">The input path is used for source map generation. It can be used to define something with string compilation or to overload the input file path. It is set to <code>stdin</code> for data contexts and to the <var>input file</var> on file contexts.</span>
        <label for="option-inputPath">inputPath</label>
        <input id="option-inputPath" type="text" value="stdin">
      </section>

      <section class="option">
        <span class="comment">The output path is used for source map generation. Libsass will not write to this file, it is just used to create information in source-maps etc.</span>
        <label for="option-outputPath">outputPath</label>
        <input id="option-outputPath" type="text" value="stdout">
      </section>

      <section class="option">
        <span class="comment">Embed include contents in source maps</span>
        <label for="option-sourceMapContents">sourceMapContents</label>
        <select id="option-sourceMapContents">
          <option value="">false</option>
          <option value="1" selected>true</option>
        </select>
      </section>

      <section class="option">
        <span class="comment">Embed sourceMappingUrl as data URI</span>
        <label for="option-sourceMapEmbed">sourceMapEmbed</label>
        <select id="option-sourceMapEmbed">
          <option value="">false</option>
          <option value="1" selected>true</option>
        </select>
      </section>

      <section class="option">
        <span class="comment">Disable sourceMappingUrl in CSS output</span>
        <label for="option-sourceMapOmitUrl">sourceMapOmitUrl</label>
        <select id="option-sourceMapOmitUrl">
          <option value="">false</option>
          <option value="1" selected>true</option>
        </select>
      </section>

    </article>

    <h2>Sass.compile()</h2>

    <article id="input-output">
      <section>
        <h3>Input</h3>
        <textarea id="input">@import "demo";
  $foo: 10px;
  .selector {
    margin: $foo;
    .nested {
      margin: $foo / 2;
    }
  }</textarea>
      </section>
      <section>
        <h3>Output</h3>
        <textarea id="output"></textarea>
      </section>
      <section>
        <h3>SourceMap</h3>
        <textarea id="sourcemap"></textarea>
      </section>
      <p><button type="button" id="convert">Convert</button></p>
    </article>


    <h2>Filesystem</h2>
    <article id="filesystem">
      <section>
        <h3>Files</h3>
        <ul id="filesystem-list">
          <li><button type="button" id="filesystem-new">add file</button></li>
        </ul>
      </section>
      <section>
        <h3>Edit File</h3>
        <input id="filesystem-file" type="text" placeholder="file name">
        <textarea id="filesystem-content" placeholder="file content"></textarea>
        <button type="button" id="filesystem-save">save file</button>
      </section>
    </article>
  </div>

  <p id="credits">
   This fun was had by <a href="https://twitter.com/cjk101010">@cjk101010</a>, <a href="https://twitter.com/asciidisco">@asciidisco</a> and <a href="https://twitter.com/rodneyrehm">@rodneyrehm</a>.
  </p>

  <script src="dist/sass.worker.js"></script>
  <script>
    Sass.initialize('dist/worker.min.js');

    var convert = document.getElementById('convert');
    var input = document.getElementById('input');
    var output = document.getElementById('output');
    var sourcemap = document.getElementById('sourcemap');

    convert.addEventListener('click', function (event) {
      event.preventDefault();
      convert.disabled = false;
      Sass.options(getOptions(), function() {
        Sass.compile(input.value, function (result) {
          if (result.status) {
            var formatted = result.formatted;
            delete result.formatted;
            output.value = formatted + '\n\n' + JSON.stringify(result, null, 2);
            sourcemap.value = '';
          } else {
            output.value = result.text;
            sourcemap.value = JSON.stringify(result.map, null, 2);
          }

        });
      })
    }, false);

    function getOptions() {
      var options = {};
      var elements = document.querySelectorAll('#options input, #options select');
      [].forEach.call(elements, function(element) {
        if (element.id.slice(0, 7) !== 'option-') {
          return;
        }

        var key = element.id.slice(7);
        options[key] = element.value;
      });

      // fix line breaks
      options.linefeed = ({
        '\\n': '\n',
        '\\r\\n': '\r\n',
      })[options.linefeed]

      return options;
    }

    var files = document.getElementById('filesystem-list');
    var editNew = document.getElementById('filesystem-new');
    var editFile = document.getElementById('filesystem-file');
    var editContent = document.getElementById('filesystem-content');
    var editSave = document.getElementById('filesystem-save');

    files.addEventListener('click', function(event) {
      if (event.target.classList.contains('filesystem-edit')) {
        readFile(event.target.parentNode);
      } else if (event.target.classList.contains('filesystem-remove')) {
        removeFile(event.target.parentNode)
      }
    });

    editSave.addEventListener('click', function(event) {
      writeFile(editFile.value, editContent.value);
    });

    editNew.addEventListener('click', function(event) {
      editFile.value = '';
      editContent.value = '';
    });

    function readFile(fileNode) {
      editFile.value = fileNode.getAttribute('data-file');
      editContent.value = fileNode.getAttribute('data-content');
    }

    function removeFile(fileNode) {
      Sass.removeFile(fileNode.getAttribute('data-file'));
      fileNode.parentNode.removeChild(fileNode);
    }

    function writeFile(file, content) {
      var item = document.getElementById('filesystem--' + file);
      if (!item) {
        item = document.createElement('li');
        item.id = 'filesystem--' + file;
        item.setAttribute('data-file', file);
        item.innerHTML = '<span></span><button type="button" class="filesystem-edit">edit</button><button type="button" class="filesystem-remove">remove</button>';
        files.insertBefore(item, files.firstElementChild);
      }

      item.firstElementChild.textContent = file;
      item.setAttribute('data-content', content);
      Sass.writeFile(file, content);
      return item;
    }

    var _demoFile = writeFile('demo.scss', '.imported { content: "yeah, file support!"; }');
    readFile(_demoFile);

    document.addEventListener("DOMContentLoaded", function(e) {
      var optionsBtn = document.querySelector('#options-btn');
      var inputOutputBtn = document.querySelector('#input-output-btn');
      var filesystemBtn = document.querySelector('#filesystem-btn');
      optionsBtn.addEventListener("click", function () {

      });
    });
  </script>
</body>
</html>
